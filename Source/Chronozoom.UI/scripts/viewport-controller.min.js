var CZ;(function(n){(function(t){function i(t,i,r){function o(n,t){var i=n.vectorScreenToVirtual(t.xOffset,t.yOffset),r=n.visible;n.visible.centerX=r.centerX-i.x;n.visible.centerY=r.centerY-i.y}function s(n,t){var r=n.visible,u=t.xOrigin+(n.width/2-t.xOrigin)*t.scaleFactor,f=t.yOrigin+(n.height/2-t.yOrigin)*t.scaleFactor,i=n.pointScreenToVirtual(u,f);n.visible.centerX=i.x;n.visible.centerY=i.y;n.visible.scale=r.scale*t.scaleFactor}function l(t,i,r){var f=t.visible,e;return i.Type=="Zoom"?(e=i.Source=="Touch"?r?r:new n.Viewport.Viewport2d(t.aspectRatio,t.width,t.height,new n.Viewport.VisibleRegion2d(f.centerX,f.centerY,f.scale)):new n.Viewport.Viewport2d(t.aspectRatio,t.width,t.height,new n.Viewport.VisibleRegion2d(f.centerX,f.centerY,f.scale)),s(e,i)):(e=r?r:new n.Viewport.Viewport2d(t.aspectRatio,t.width,t.height,new n.Viewport.VisibleRegion2d(f.centerX,f.centerY,f.scale)),o(e,i)),u.coerceVisible(e,i),e}function a(t,i){n.Data.getTimelines({lca:i.guid,start:t.left,end:t.right,minspan:n.Settings.minTimelineWidth*t.scale}).then(function(t){n.Layout.Merge(t,i)},function(n){console.log("Error connecting to service:\n"+n.responseText)})}function v(n){var t=[];return n.exhibits instanceof Array&&n.exhibits.forEach(function(n){t.push(n.id)}),n.timelines instanceof Array&&n.timelines.forEach(function(n){t=t.concat(v(n))}),t}function h(n,t,i){n.children.forEach(function(n){if(n.type==="infodot"){var r=t.indexOf(n.guid);r!==-1&&(n.contentItems=i[r].contentItems)}});n.children.forEach(function(n){n.type==="timeline"&&h(n,t,i)})}function e(n,t){for(var i=0;i<u.onAnimationUpdated.length;i++)u.onAnimationUpdated[i](n,t)}function c(n){for(var t=0;t<u.onAnimationStarted.length;t++)u.onAnimationStarted[t](n)}var u,f;this.activeAnimation;this.FPS;this.maximumPermitedScale;this.leftPermitedBound;this.rightPermitedBound;this.topPermitedBound;this.bottomPermitedBound;this.effectiveExplorationZoomConstraint=undefined;window.requestAnimFrame||(window.requestAnimFrame=function(t){window.setTimeout(t,1e3/n.Settings.targetFps)});this.viewportWidth;this.viewportHeight;this.setVisible=t;this.getViewport=i;u=this;this.estimatedViewport=undefined;this.recentViewport=undefined;this.onAnimationComplete=[];this.onAnimationUpdated=[];this.onAnimationStarted=[];this.saveScreenParameters=function(n){u.viewportWidth=n.width;u.viewportHeight=n.height};this.coerceVisible=function(n,t){this.coerceVisibleInnerZoom(n,t);this.coerceVisibleOuterZoom(n,t);this.coerceVisibleHorizontalBound(n);this.coerceVisibleVerticalBound(n)};this.coerceVisibleOuterZoom=function(t,i){if(i.Type==="Zoom"){var r=t.visible;typeof n.Common.maxPermitedScale!="undefined"&&n.Common.maxPermitedScale&&r.scale>n.Common.maxPermitedScale&&(i.scaleFactor=n.Common.maxPermitedScale/r.scale,s(t,i))}};this.coerceVisibleHorizontalBound=function(t){var i=t.visible;n.Settings.maxPermitedTimeRange&&(i.centerX>n.Settings.maxPermitedTimeRange.right?i.centerX=n.Settings.maxPermitedTimeRange.right:i.centerX<n.Settings.maxPermitedTimeRange.left&&(i.centerX=n.Settings.maxPermitedTimeRange.left))};this.coerceVisibleVerticalBound=function(t){var i=t.visible;n.Common.maxPermitedVerticalRange&&(i.centerY>n.Common.maxPermitedVerticalRange.bottom?i.centerY=n.Common.maxPermitedVerticalRange.bottom:i.centerY<n.Common.maxPermitedVerticalRange.top&&(i.centerY=n.Common.maxPermitedVerticalRange.top))};this.coerceVisibleInnerZoom=function(t){var f=t.visible,e=f.centerX,o=f.scale,i=undefined,r,u;if(this.effectiveExplorationZoomConstraint)i=this.effectiveExplorationZoomConstraint;else for(r=0;r<n.Settings.deeperZoomConstraints.length;r++)if(u=n.Settings.deeperZoomConstraints[r],u.left<=e&&u.right>e){i=u.scale;break}i&&o<i&&(f.scale=i)};u.updateRecentViewport=function(){var t=i(),r=t.visible;u.recentViewport=new n.Viewport.Viewport2d(t.aspectRatio,t.width,t.height,new n.Viewport.VisibleRegion2d(r.centerX,r.centerY,r.scale))};f=null;this.getMissingData=function(t,i){(typeof n.Authoring=="undefined"||n.Authoring.isActive===!1)&&(window.clearTimeout(f),f=window.setTimeout(function(){a(t,i)},1e3))};r.Subscribe(function(t){var f,o,i;if(typeof t!="undefined"&&!n.Authoring.isActive){if(f=u.activeAnimation,o=f?u.activeAnimation.ID:undefined,u.updateRecentViewport(),i=u.recentViewport,t.Type=="Pin"){u.stopAnimation();return}if(t.Type=="Pan"||t.Type=="Zoom"){var s=l(i,t,u.estimatedViewport),r=n.Common.viewportToViewBox(s),h=new n.VCContent.CanvasRectangle(null,null,null,r.left,r.top,r.width,r.height,null);u.estimatedViewport||(u.activeAnimation=new n.ViewportAnimation.PanZoomAnimation(i),u.saveScreenParameters(i));u.activeAnimation.velocity=t.Type=="Pan"?n.Settings.panSpeedFactor*.001:n.Settings.zoomSpeedFactor*.0025;u.activeAnimation.setTargetViewport(s);u.estimatedViewport=s}o!=undefined?e(o,u.activeAnimation.ID):c(u.activeAnimation.ID);f||u.animationStep(u)}});u.updateRecentViewport();this.saveScreenParameters(u.recentViewport);this.stopAnimation=function(){u.estimatedViewport=undefined;u.activeAnimation&&(u.activeAnimation.isForciblyStoped=!0,u.activeAnimation.isActive=!1,e(u.activeAnimation.ID,undefined))};this.animationStep=function(i){var e,r,u,o,f;if(i.activeAnimation){if(i.activeAnimation.isActive)window.requestAnimFrame(function(){i.animationStep(i)});else{if(e=i.activeAnimation.ID,i.updateRecentViewport(),t(new n.Viewport.VisibleRegion2d(i.recentViewport.visible.centerX,i.recentViewport.visible.centerY,i.recentViewport.visible.scale)),!i.activeAnimation.isForciblyStoped)for(r=0;r<i.onAnimationComplete.length;r++)i.onAnimationComplete[r](e);i.activeAnimation=undefined;i.estimatedViewport=undefined;return}u=i.recentViewport;(i.viewportWidth!=u.width||i.viewportHeight!=u.height)&&i.stopAnimation();o=i.activeAnimation.produceNextVisible(u);t(o)}this.frames++;this.oneSecondFrames++;f=n.Common.vc.virtualCanvas("getLastEvent");f!=null&&n.Common.vc.virtualCanvas("mouseMove",f)};this.frames=0;this.oneSecondFrames=0;window.setInterval(function(){u.FPS=u.oneSecondFrames;u.oneSecondFrames=0},1e3);this.PanViewportAccessor=o;this.moveToVisible=function(t,r){var s=i(),a=new n.Viewport.Viewport2d(s.aspectRatio,s.width,s.height,t),f=n.Common.viewportToViewBox(a),v=new n.VCContent.CanvasRectangle(null,null,null,f.left,f.top,f.width,f.height,null),h,l,o;if(r){u.stopAnimation();u.setVisible(t);return}return h=!1,l=undefined,this.activeAnimation&&(h=this.activeAnimation.isActive,l=this.activeAnimation.ID),u.updateRecentViewport(),o=u.recentViewport,this.estimatedViewport=undefined,this.activeAnimation=new n.ViewportAnimation.EllipticalZoom(o.visible,t),u.viewportWidth=o.width,u.viewportHeight=o.height,h?e(l,this.activeAnimation.ID):(this.activeAnimation.isActive&&c(this.activeAnimation.ID),setTimeout(function(){return u.animationStep(u)},0)),this.activeAnimation?this.activeAnimation.ID:undefined}}t.ViewportController2=i})(n.ViewportController||(n.ViewportController={}));var t=n.ViewportController})(CZ||(CZ={}));
/*
//# sourceMappingURL=viewport-controller.min.js.map
*/