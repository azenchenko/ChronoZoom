var CZ;(function(n){(function(t){function f(t){return n.UrlNav.navStringToVisible(t.url,n.Common.vc)}function b(){return t.tour!=undefined}function k(t){var i=n.UrlNav.navStringTovcElement(t,n.Common.vc.virtualCanvas("getLayerContent"));return i?i:null}function l(n,i){if(i==undefined&&(i=t.isNarrationOn),n!=undefined){t.tour=n;t.tour.tour_TourFinished.push(function(){ut();r();h()});t.tour.toggleAudio(i);for(var u=0;u<t.tour.bookmarks.length;u++)t.tour.bookmarks[u].elapsed=0;t.tour.currentPlace.bookmark=0;i==!0&&(t.tour.ReinitializeAudio(),t.tour.isAudioLoaded=!0);s()}}function a(){t.tour&&(r(),t.tour.isTourPlayRequested=!1);t.tour&&(h(),$("#bookmarks .header").text(""),t.tour.audioElement&&(t.tour.audioElement=undefined));t.tour=undefined}function d(){t.tour!=undefined&&t.tour.prev()}function g(){t.tour!=undefined&&t.tour.next()}function r(){t.tourCaptionForm.setPlayPauseButtonState("play");t.tour!=undefined&&($("#tour_playpause").attr("src","/images/tour_play_off.jpg"),t.tour.pause(),n.Common.controller.stopAnimation(),t.tour.tourBookmarkTransitionInterrupted=undefined,t.tour.tourBookmarkTransitionCompleted=undefined)}function s(){t.tourCaptionForm.setPlayPauseButtonState("pause");$("#tour_playpause").attr("src","/images/tour_pause_off.jpg");t.tour.play()}function nt(){t.tour!=undefined&&(t.tour.state=="pause"?s():t.tour.state=="play"&&r())}function tt(){a();$("#bookmarks").hide();c=!1;var t=n.UrlNav.getURL();t.hash.params.tour&&delete t.hash.params.tour;n.UrlNav.setURL(t)}function it(){$("#tours").hide();h()}function v(){t.tours.sort(function(n,t){return n.sequenceNum-t.sequenceNum})}function rt(){t.tourCaptionForm.hideBookmark()}function ut(){t.tourCaptionForm.showTourEndMessage()}function y(n,i){t.tourCaptionForm.showBookmark(i)}function h(){$("#bookmarks").hide();c=!1}function p(){n.Search.isSearchWindowVisible&&n.Search.onSearchClicked();t.isTourWindowVisible?($(".tour-icon").removeClass("active"),$("#tours").hide("slide",{},"slow")):($(".tour-icon").addClass("active"),$("#tours").show("slide",{},"slow"));t.isTourWindowVisible=!t.isTourWindowVisible}function ft(){u&&(u=!1,$("#bookmarks .header").hide("slide",{},"fast"),$("#bookmarks .slideHeader").hide("slide",{},"fast"),$("#bookmarks .slideText").hide("slide",{},"fast"),$("#bookmarks .slideFooter").hide("slide",{},"fast"),$("#bookmarks").effect("size",{to:{width:"30px"}},"fast",function(){$("#bookmarks").css("width","30px")}),$("#bookmarksCollapse").attr("src","/images/expand-right.png"))}function et(){u||(u=!0,$("#bookmarks").effect("size",{to:{width:"200px",height:"auto"}},"slow",function(){$("#bookmarks").css("width","200px");$("#bookmarks").css("height","auto");$("#bookmarks .header").show("slide",{},"fast");$("#bookmarks .slideHeader").show("slide",{},"fast");$("#bookmarks .slideText").show("slide",{},"fast");$("#bookmarks .slideFooter").show("slide",{},"fast")}),$("#bookmarksCollapse").attr("src","/images/collapse-left.png"))}function ot(){u?ft():et()}function st(){t.isNarrationOn?($("#tours-narration-on").removeClass("narration-selected","slow"),$("#tours-narration-off").addClass("narration-selected","slow")):($("#tours-narration-on").addClass("narration-selected","slow"),$("#tours-narration-off").removeClass("narration-selected","slow"));t.isNarrationOn=!t.isNarrationOn}function ht(i){var f,h,r,c,s,u,l;for(t.tours=[],f=0;f<i.d.length;f++)if(h=!0,r=i.d[f],typeof r.bookmarks!="undefined"&&typeof r.name!="undefined"&&typeof r.sequence!="undefined"&&r.bookmarks.length!=0){for(c=[],s=0;s<r.bookmarks.length;s++){if(u=r.bookmarks[s],typeof u.description=="undefined"||typeof u.lapseTime=="undefined"||typeof u.name=="undefined"||typeof u.url=="undefined"){h=!1;break}c.push(new e(u.url,u.name,u.lapseTime,u.description))}h&&(l=new o(r.id,r.name,c,w,n.Common.vc,r.category,r.audio,r.sequence,r.description),t.tours.push(l))}$("body").trigger("toursInitialized")}function w(i,r,u,f){t.tourBookmarkTransitionCompleted=r;t.tourBookmarkTransitionInterrupted=u;t.pauseTourAtAnyAnimation=!1;var e=n.Common.setVisible(i);return e&&f&&(n.Common.setNavigationStringTo={bookmark:f,id:e}),e}function ct(){var i=n.UrlNav.getURL();typeof i.hash.params!="undefined"&&i.hash.params.tour>t.tours.length||typeof i.hash.params!="undefined"&&typeof i.hash.params.tour!="undefined"&&(t.tours==null&&v(),t.isTourWindowVisible&&p(),t.tour=t.tours[i.hash.params.tour-1],$(".touritem-selected").removeClass("touritem-selected","slow"),l(t.tour,!0),t.tour.audio&&(t.tour.audio.pause(),t.tour.audio.preload="none"),r())}var i,e,o;t.isTourWindowVisible=!1;var c=!1,u=!0;t.isNarrationOn=!0;t.tours;t.tour;t.tourBookmarkTransitionCompleted;t.tourBookmarkTransitionInterrupted;t.pauseTourAtAnyAnimation=!1;i=!1;t.TourEndMessage="Thank you for watching this tour!";t.tourCaptionFormContainer;t.tourCaptionForm;e=function(){function n(n,t,i,r){this.url=n;this.caption=t;this.lapseTime=i;this.text=r;this.duration=undefined;this.elapsed=0;this.text===null&&(this.text="")}return n}();t.TourBookmark=e;t.getBookmarkVisible=f;t.hasActiveTour=b;t.bookmarkUrlToElement=k;o=function(){function u(u,e,o,s,h,c,l,a,v){var p,w;if(this.id=u,this.title=e,this.bookmarks=o,this.zoomTo=s,this.vc=h,this.category=c,this.audio=l,this.sequenceNum=a,this.description=v,this.tour_BookmarkStarted=[],this.tour_BookmarkFinished=[],this.tour_TourStarted=[],this.tour_TourFinished=[],this.state="pause",this.currentPlace={type:"goto",bookmark:0,startTime:null,animationId:null},this.isTourPlayRequested=!1,this.isAudioLoaded=!1,this.isAudioEnabled=!1,!o||o.length==0)throw"Tour has no bookmarks";for(p=this,this.thumbnailUrl=n.Settings.contentItemThumbnailBaseUri+u+".jpg",o.sort(function(n,t){return n.lapseTime-t.lapseTime}),w=1;w<o.length;w++)o[w-1].number=w,o[w-1].duration=o[w].lapseTime-o[w-1].lapseTime;o[o.length-1].duration=10;o[o.length-1].number=o.length;p.toggleAudio=function(n){p.isAudioEnabled=n&&p.audio?!0:!1};p.ReinitializeAudio=function(){var u,t,r;if(p.audio){for(p.audioElement&&p.audioElement.pause(),p.audioElement=undefined,p.isAudioLoaded=!1,p.audioElement=document.createElement("audio"),p.audioElement.addEventListener("loadedmetadata",function(){p.audioElement.duration!=Infinity&&(p.bookmarks[p.bookmarks.length-1].duration=p.audioElement.duration-p.bookmarks[p.bookmarks.length-1].lapseTime);i&&window.console&&console.log("Tour "+p.title+" metadata loaded (readystate 1)")}),p.audioElement.addEventListener("canplaythrough",function(){p.isAudioLoaded=!0;i&&window.console&&console.log("Tour "+p.title+" readystate 4")}),p.audioElement.addEventListener("progress",function(){p.audioElement&&p.audioElement.buffered.length>0&&i&&window.console&&console.log("Tour "+p.title+" downloaded "+p.audioElement.buffered.end(p.audioElement.buffered.length-1)/p.audioElement.duration)}),p.audioElement.controls=!1,p.audioElement.autoplay=!1,p.audioElement.loop=!1,p.audioElement.volume=1,p.audioElement.preload="none",u=p.audio.substring(0,p.audio.length-3),t=0;t<n.Settings.toursAudioFormats.length;t++)r=document.createElement("Source"),r.setAttribute("src",u+n.Settings.toursAudioFormats[t].ext),p.audioElement.appendChild(r);p.audioElement.load();i&&window.console&&console.log("Loading of tour "+p.title+" is queued")}};p.onBookmarkIsOver=function(n){p.bookmarks[p.currentPlace.bookmark].elapsed=0;p.currentPlace.bookmark!=p.bookmarks.length-1||n?p.goToTheNextBookmark(n):(p.state="pause",p.currentPlace={type:"goto",bookmark:0},p.RaiseTourFinished())};p.goToTheNextBookmark=function(n){var t=p.currentPlace.bookmark,e=t,r,u;if(t=n?Math.max(0,t-1):Math.min(p.bookmarks.length-1,t+1),p.RaiseBookmarkFinished(e),p.currentPlace={type:"goto",bookmark:t},r=p.bookmarks[p.currentPlace.bookmark],t!=0&&(p.RaiseBookmarkStarted(r),p.isAudioEnabled&&p.state==="play"&&p.isAudioLoaded==!0&&p.startBookmarkAudio(r)),p.state!="pause"&&p.isAudioLoaded==!0&&p.setTimer(r),i&&window.console&&console.log("Transitioning to the bm index "+t),u=f(r),!u){i&&window.console&&console.log("bookmark index "+t+" references to nonexistent item");n?p.prev():p.next();return}p.currentPlace.animationId=p.zoomTo(f(r),p.onGoToSuccess,p.onGoToFailure,r.url)};p.startBookmarkAudio=function(n){if(p.audio){i&&window.console&&console.log("playing source: "+p.audioElement.currentSrc);p.audioElement.pause();try{p.audioElement.currentTime=n.lapseTime+n.elapsed;i&&window.console&&console.log("audio currentTime is set to "+(n.lapseTime+n.elapsed))}catch(t){window.console&&console.error("currentTime assignment: "+t)}i&&window.console&&console.log("audio element is forced to play");p.audioElement.play()}};p.setTimer=function(n){p.timerOnBookmarkIsOver&&clearTimeout(p.timerOnBookmarkIsOver);var t=n.duration;n.elapsed!=0&&(t=Math.max(t-n.elapsed,0));p.currentPlace.startTime=(new Date).getTime();i&&window.console&&console.log("transition to next bookmark will be in "+t+" seconds");p.timerOnBookmarkIsOver=setTimeout(p.onBookmarkIsOver,t*1e3)};p.onGoToSuccess=function(u){var f,e;p.currentPlace&&p.currentPlace.animationId!=undefined&&p.currentPlace.animationId==u&&(f=n.UrlNav.getURL(),typeof f.hash.params=="undefined"&&(f.hash.params=[]),f.hash.params.tour=t.tour.sequenceNum,n.Common.hashHandle=!1,n.UrlNav.setURL(f),i&&window.console&&console.log("reached the bookmark index "+p.currentPlace.bookmark),p.currentPlace={type:"bookmark",bookmark:p.currentPlace.bookmark},p.currentPlace.bookmark==0&&(e=p.bookmarks[p.currentPlace.bookmark],p.RaiseBookmarkStarted(e),p.state!="pause"&&(p.isAudioLoaded!=!0?r():(p.setTimer(e),p.isAudioEnabled&&p.startBookmarkAudio(e)))))};p.onGoToFailure=function(n){p.currentPlace&&p.currentPlace.animationId!=undefined&&p.currentPlace.animationId==n&&(p.pause(),i&&window.console&&console.log("tour interrupted by user during transition"))};p.play=function(){var o,e,r,s,u;if(p.state==="pause"){if(i&&window.console&&console.log("tour playback activated"),p.state="play",o=p.vc.virtualCanvas("getViewport").visible,e=f(p.bookmarks[p.currentPlace.bookmark]),e===null){p.next();return}p.currentPlace=p.currentPlace!=null&&p.currentPlace.bookmark!=null&&n.Common.compareVisibles(o,e)?{type:"bookmark",bookmark:p.currentPlace.bookmark}:{type:"goto",bookmark:p.currentPlace.bookmark};r=p.bookmarks[p.currentPlace.bookmark];y(t.tour,r);s=p.currentPlace.bookmark==0&&p.currentPlace.type=="goto";(p.currentPlace.type=="bookmark"||p.currentPlace.bookmark!=0)&&(p.RaiseBookmarkStarted(r),p.isAudioLoaded==!0&&(p.setTimer(r),p.isAudioEnabled&&p.startBookmarkAudio(r)));p.currentPlace.animationId=p.zoomTo(f(r),p.onGoToSuccess,p.onGoToFailure,r.url);p.currentPlace.bookmark===0&&s&&p.RaiseTourStarted();u=n.UrlNav.getURL();typeof u.hash.params=="undefined"&&(u.hash.params=[]);typeof u.hash.params.tour=="undefined"&&(u.hash.params.tour=t.tour.sequenceNum,n.Common.hashHandle=!1,n.UrlNav.setURL(u))}};p.pause=function(){if(p.state==="play"){i&&window.console&&console.log("tour playback paused");p.isAudioEnabled&&p.isTourPlayRequested&&(p.isTourPlayRequested=!1);p.timerOnBookmarkIsOver&&(clearTimeout(p.timerOnBookmarkIsOver),p.timerOnBookmarkIsOver=undefined);p.state="pause";p.isAudioEnabled&&(p.audioElement.pause(),i&&window.console&&console.log("audio element is forced to pause"));var n=p.bookmarks[p.currentPlace.bookmark];p.currentPlace.startTime&&(n.elapsed+=((new Date).getTime()-p.currentPlace.startTime)/1e3)}};p.next=function(){p.state==="play"&&(p.timerOnBookmarkIsOver&&clearTimeout(p.timerOnBookmarkIsOver),p.timerOnBookmarkIsOver=undefined);p.onBookmarkIsOver(!1)};p.prev=function(){if(p.currentPlace.bookmark!=0){p.state==="play"&&(p.timerOnBookmarkIsOver&&clearTimeout(p.timerOnBookmarkIsOver),p.timerOnBookmarkIsOver=undefined);p.onBookmarkIsOver(!0)}};p.RaiseBookmarkStarted=function(n){if(p.tour_BookmarkStarted.length>0)for(var t=0;t<p.tour_BookmarkStarted.length;t++)p.tour_BookmarkStarted[t](p,n);y(this,n)};p.RaiseBookmarkFinished=function(n){if(p.tour_BookmarkFinished.length>0)for(var t=0;t<p.tour_BookmarkFinished.length;t++)p.tour_BookmarkFinished[t](p,n);rt(this)};p.RaiseTourStarted=function(){if(p.tour_TourStarted.length>0)for(var n=0;n<p.tour_TourStarted.length;n++)p.tour_TourStarted[n](p)};p.RaiseTourFinished=function(){if(p.tour_TourFinished.length>0)for(var n=0;n<p.tour_TourFinished.length;n++)p.tour_TourFinished[n](p)}}return u}();t.Tour=o;t.activateTour=l;t.removeActiveTour=a;t.tourPrev=d;t.tourNext=g;t.tourPause=r;t.tourResume=s;t.tourPlayPause=nt;t.tourAbort=tt;t.initializeToursUI=it;t.initializeToursContent=v;t.onTourClicked=p;t.onBookmarksCollapse=ot;t.onNarrationClick=st;t.parseTours=ht;t.bookmarkTransition=w;t.loadTourFromURL=ct})(n.Tours||(n.Tours={}));var t=n.Tours})(CZ||(CZ={}));
/*
//# sourceMappingURL=tours.min.js.map
*/