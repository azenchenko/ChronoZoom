var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},CZ;(function(n){(function(t){var i=function(t){function i(i,r){var u=this;t.call(this,i,r);this.saveButton=i.find(r.saveButton);this.deleteButton=i.find(r.deleteButton);this.startDate=new n.UI.DatePicker(i.find(r.startDate));this.endDate=new n.UI.DatePicker(i.find(r.endDate));this.titleInput=i.find(r.titleInput);this.errorMessage=i.find(r.errorMessage);this.mapViewBtn=i.find(".cz-map-view");this.timeline=r.context;this.exhibits={};this.timeline.exhibits.map(function(n){return u.exhibits[n.guid]={infodotDescription:n.infodotDescription,contentItems:n.contentItems,mapAreaId:n.mapAreaId}});this.onMapExhibits=null;this.saveButton.off();this.deleteButton.off();this.mapViewBtn.off();this.mapViewBtn.show().on("click",function(){u.hide(!0);n.Authoring.showSelectMapTypeForm(u,{timeline:u.timeline,exhibits:u.exhibits})});this.titleInput.focus(function(){u.titleInput.hideError()});this.initialize()}return __extends(i,t),i.prototype.initialize=function(){var t=this;this.saveButton.prop("disabled",!1);n.Authoring.mode==="createTimeline"?(this.deleteButton.hide(),this.titleTextblock.text("Create Timeline"),this.saveButton.text("Create Timeline")):n.Authoring.mode==="editTimeline"?(this.deleteButton.show(),this.titleTextblock.text("Edit Timeline"),this.saveButton.text("Update Timeline")):n.Authoring.mode==="createRootTimeline"?(this.deleteButton.hide(),this.closeButton.hide(),this.titleTextblock.text("Create Root Timeline"),this.saveButton.text("Create Timeline")):(console.log("Unexpected authoring mode in timeline form."),this.close());this.isCancel=!0;this.endDate.addEditMode_Infinite();this.titleInput.val(this.timeline.title);this.startDate.setDate(this.timeline.x,!0);this.timeline.endDate===9999?this.endDate.setDate(this.timeline.endDate,!0):this.endDate.setDate(this.timeline.x+this.timeline.width,!0);this.timeline.exhibits.length===0&&this.mapViewBtn.hide();this.saveButton.click(function(){var r,i;if(t.errorMessage.empty(),r=!1,r=n.Authoring.validateTimelineData(t.startDate.getDate(),t.endDate.getDate(),t.titleInput.val()),n.Authoring.isNotEmpty(t.titleInput.val())||t.titleInput.showError("Title can't be empty"),n.Authoring.isIntervalPositive(t.startDate.getDate(),t.endDate.getDate())||t.errorMessage.text("Time interval should no less than one day"),r)t.errorMessage.empty(),i=t,t.saveButton.prop("disabled",!0),t.timeline.onMapExhibits=t.onMapExhibits,n.Authoring.updateTimeline(t.timeline,{title:t.titleInput.val(),start:t.startDate.getDate(),end:t.endDate.getDate(),mapViewExhibits:t.exhibits}).then(function(){i.isCancel=!1;i.close();i.timeline.onmouseclick()},function(n){n!==undefined&&n!==null?i.errorMessage.text(n).show().delay(7e3).fadeOut():i.errorMessage.text("Sorry, internal server error :(").show().delay(7e3).fadeOut();console.log(n)}).always(function(){t.saveButton.prop("disabled",!1)});else return});this.deleteButton.click(function(){if(confirm("Are you sure want to delete timeline and all of its nested timelines and exhibits? Delete can't be undone!"))n.Authoring.removeTimeline(t.timeline),t.close()})},i.prototype.show=function(){t.prototype.show.call(this,{effect:"slide",direction:"left",duration:500});this.activationSource.addClass("active")},i.prototype.close=function(){var i=this;this.errorMessage.empty();t.prototype.close.call(this,{effect:"slide",direction:"left",duration:500,complete:function(){i.endDate.remove();i.startDate.remove();i.titleInput.hideError()}});this.isCancel&&n.Authoring.mode==="createTimeline"&&(n.VCContent.removeChild(this.timeline.parent,this.timeline.id),n.Common.vc.virtualCanvas("requestInvalidate"));n.Authoring.isActive=!1;this.activationSource.removeClass("active");n.Common.vc.virtualCanvas("showNonRootVirtualSpace")},i.prototype.hide=function(){var n=this;this.errorMessage.empty();t.prototype.close.call(this,{effect:"slide",direction:"left",duration:500,complete:function(){n.titleInput.hideError()}})},i}(n.UI.FormUpdateEntity);t.FormEditTimeline=i})(n.UI||(n.UI={}));var t=n.UI})(CZ||(CZ={}));
/*
//# sourceMappingURL=auth-edit-timeline-form.min.js.map
*/