var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},CZ;(function(n){(function(t){var i=function(i){function r(t,r){var u=this;i.call(this,t,r);this.titleTextblock=t.find(r.titleTextblock);this.titleInput=t.find(r.titleInput);this.mediaInput=t.find(r.mediaInput);this.mediaSourceInput=t.find(r.mediaSourceInput);this.mediaTypeInput=t.find(r.mediaTypeInput);this.attributionInput=t.find(r.attributionInput);this.descriptionInput=t.find(r.descriptionInput);this.errorMessage=t.find(r.errorMessage);this.saveButton=t.find(r.saveButton);this.mediaListContainer=t.find(r.mediaListContainer);this.titleInput.focus(function(){u.titleInput.hideError()});this.mediaInput.focus(function(){u.mediaInput.hideError()});this.mediaSourceInput.focus(function(){u.mediaSourceInput.hideError()});this.prevForm=r.prevForm;this.exhibit=r.context.exhibit;this.contentItem=r.context.contentItem;this.mode=n.Authoring.mode;this.isCancel=!0;this.isModified=!1;this.initUI()}return __extends(r,i),r.prototype.initUI=function(){var i=this,r;this.mediaList=new n.UI.MediaList(this.mediaListContainer,n.Media.mediaPickers,this.contentItem,this);r=this;this.saveButton.prop("disabled",!1);this.titleInput.change(function(){i.isModified=!0});this.mediaInput.change(function(){i.isModified=!0});this.mediaSourceInput.change(function(){i.isModified=!0});this.mediaTypeInput.change(function(){i.isModified=!0});this.attributionInput.change(function(){i.isModified=!0});this.descriptionInput.change(function(){i.isModified=!0});this.descriptionInput.on("keyup",function(n){n.which==13&&r.saveButton.click(function(){return r.onSave()})});this.descriptionInput.on("keydown",function(n){n.which==13&&r.saveButton.off()});n.Media.SkyDriveMediaPicker.isEnabled&&this.mediaTypeInput.find("option[value='skydrive-image']").length===0&&($("<option><\/option>",{value:"skydrive-image",text:" Skydrive Image "}).appendTo(this.mediaTypeInput),$("<option><\/option>",{value:"skydrive-document",text:" Skydrive Document "}).appendTo(this.mediaTypeInput));this.titleInput.val(this.contentItem.title||"");this.mediaInput.val(this.contentItem.uri||"");this.mediaSourceInput.val(this.contentItem.mediaSource||"");this.mediaTypeInput.val(this.contentItem.mediaType||"");this.attributionInput.val(this.contentItem.attribution||"");this.descriptionInput.val(this.contentItem.description||"");this.saveButton.off();this.saveButton.click(function(){return i.onSave()});n.Authoring.contentItemMode==="createContentItem"?(this.titleTextblock.text("Create New"),this.saveButton.text("Create Artifiact"),this.closeButton.hide()):n.Authoring.contentItemMode==="editContentItem"?(this.titleTextblock.text("Edit"),this.saveButton.text("Update Artifact"),this.prevForm&&this.prevForm instanceof t.FormEditExhibit?this.closeButton.hide():this.closeButton.show()):(console.log("Unexpected authoring mode in content item form."),this.close());this.saveButton.show()},r.prototype.onSave=function(){var r=this,i={title:this.titleInput.val()||"",uri:this.mediaInput.val()||"",mediaSource:this.mediaSourceInput.val()||"",mediaType:this.mediaTypeInput.val()||"",attribution:this.attributionInput.val()||"",description:this.descriptionInput.val()||"",order:this.contentItem.order},u;n.Authoring.isNotEmpty(i.title)||this.titleInput.showError("Title can't be empty");n.Authoring.isNotEmpty(i.uri)||this.mediaInput.showError("URL can't be empty");n.Authoring.isValidURL(i.uri)||this.mediaInput.showError("URL is wrong");n.Authoring.validateContentItems([i],this.mediaInput)&&n.Authoring.isValidURL(i.uri)?n.Authoring.contentItemMode==="createContentItem"?this.prevForm&&this.prevForm instanceof t.FormEditExhibit&&(this.isCancel=!1,this.prevForm.contentItemsListbox.add(i),$.extend(this.exhibit.contentItems[this.contentItem.order],i),this.prevForm.exhibit=this.exhibit=n.Authoring.renewExhibit(this.exhibit),n.Common.vc.virtualCanvas("requestInvalidate"),this.isModified=!1,this.back()):n.Authoring.contentItemMode==="editContentItem"&&(this.prevForm&&this.prevForm instanceof t.FormEditExhibit?(this.isCancel=!1,u=this.prevForm.clickedListItem,u.iconImg.attr("src",i.uri),u.titleTextblock.text(i.title),u.descrTextblock.text(i.description),$.extend(this.exhibit.contentItems[this.contentItem.order],i),this.prevForm.exhibit=this.exhibit=n.Authoring.renewExhibit(this.exhibit),this.prevForm.isModified=!0,n.Common.vc.virtualCanvas("requestInvalidate"),this.isModified=!1,this.back()):(this.saveButton.prop("disabled",!0),n.Authoring.updateContentItem(this.exhibit,this.contentItem,i).then(function(){r.isCancel=!1;r.isModified=!1;r.close()},function(n){var t=n.statusText;t.match(/Media Source/)?(r.errorMessage.text("One or more fields filled wrong"),r.mediaSourceInput.showError("Media Source URL is not a valid URL")):r.errorMessage.text("Sorry, internal server error :(");r.errorMessage.show().delay(7e3).fadeOut()}).always(function(){r.saveButton.prop("disabled",!1)}))):this.errorMessage.text("One or more fields filled wrong").show().delay(7e3).fadeOut()},r.prototype.updateMediaInfo=function(){this.mediaInput.val(this.contentItem.uri||"");this.mediaSourceInput.val(this.contentItem.mediaSource||"");this.mediaTypeInput.val(this.contentItem.mediaType||"");this.attributionInput.val(this.contentItem.attribution||"")},r.prototype.show=function(t){n.Authoring.isActive=!0;this.activationSource.addClass("active");this.errorMessage.hide();i.prototype.show.call(this,t?undefined:{effect:"slide",direction:"left",duration:500})},r.prototype.close=function(t){var r=this;if(typeof t=="undefined"&&(t=!1),this.isModified)if(window.confirm("There is unsaved data. Do you want to close without saving?"))this.isModified=!1;else return;i.prototype.close.call(this,t?undefined:{effect:"slide",direction:"left",duration:500,complete:function(){r.mediaList.remove();r.mediaInput.hideError();r.titleInput.hideError();r.mediaSourceInput.hideError()}});this.isCancel&&n.Authoring.contentItemMode==="createContentItem"&&this.exhibit.contentItems.pop();this.activationSource.removeClass("active");n.Authoring.isActive=!1},r}(n.UI.FormUpdateEntity);t.FormEditCI=i})(n.UI||(n.UI={}));var t=n.UI})(CZ||(CZ={}));
/*
//# sourceMappingURL=auth-edit-contentitem-form.min.js.map
*/