var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},CZ;(function(n){(function(t){var i=function(t){function i(i,r){var u=this;t.call(this,i,r);this.contentItem={};this.saveButton=i.find(r.saveButton);this.backgroundInput=i.find(r.backgroundInput);this.collectionTheme=r.collectionTheme;this.activeCollectionTheme=jQuery.extend(!0,{},r.collectionTheme);this.mediaListContainer=i.find(r.mediaListContainer);this.kioskmodeInput=r.kioskmodeInput;this.chkEditors=i.find(r.chkEditors);this.btnEditors=i.find(r.btnEditors);this.timelineBackgroundColorInput=r.timelineBackgroundColorInput;this.timelineBackgroundOpacityInput=r.timelineBackgroundOpacityInput;this.timelineBorderColorInput=r.timelineBorderColorInput;this.exhibitBackgroundColorInput=r.exhibitBackgroundColorInput;this.exhibitBackgroundOpacityInput=r.exhibitBackgroundOpacityInput;this.exhibitBorderColorInput=r.exhibitBorderColorInput;this.backgroundInput.on("input",function(){u.updateCollectionTheme(!0)});this.kioskmodeInput.change(function(){u.updateCollectionTheme(!0)});this.timelineBackgroundColorInput.change(function(){u.updateCollectionTheme(!0)});this.timelineBackgroundOpacityInput.change(function(){u.updateCollectionTheme(!0)});this.timelineBorderColorInput.change(function(){u.updateCollectionTheme(!0)});this.exhibitBackgroundColorInput.change(function(){u.updateCollectionTheme(!0)});this.exhibitBackgroundOpacityInput.change(function(){u.updateCollectionTheme(!0)});this.exhibitBorderColorInput.change(function(){u.updateCollectionTheme(!0)});this.backgroundInput.focus(function(){u.backgroundInput.hideError()});try{this.initialize()}catch(f){console.log("Error initializing collection form attributes")}this.saveButton.off().click(function(){u.updateCollectionTheme(!0);u.activeCollectionTheme=u.collectionTheme;var t={theme:JSON.stringify(u.collectionTheme),MembersAllowed:$(u.chkEditors).prop("checked")};n.Service.putCollection(n.Service.superCollectionName,n.Service.collectionName,t).always(function(){u.saveButton.prop("disabled",!1);u.close()})})}return __extends(i,t),i.prototype.initialize=function(){var t=this;this.saveButton.prop("disabled",!1);this.backgroundInput.val(this.collectionTheme.backgroundUrl);this.mediaList=new n.UI.MediaList(this.mediaListContainer,n.Media.mediaPickers,this.contentItem,this);this.kioskmodeInput.prop("checked",!1);this.collectionTheme.timelineColor||(this.collectionTheme.timelineColor=n.Settings.timelineColorOverride);this.timelineBackgroundColorInput.val(this.getHexColorFromColor(this.collectionTheme.timelineColor));this.timelineBackgroundOpacityInput.val(this.getOpacityFromRGBA(this.collectionTheme.timelineColor).toString());this.timelineBorderColorInput.val(this.getHexColorFromColor(this.collectionTheme.timelineStrokeStyle));this.exhibitBackgroundColorInput.val(this.getHexColorFromColor(this.collectionTheme.infoDotFillColor));this.exhibitBackgroundOpacityInput.val(this.getOpacityFromRGBA(this.collectionTheme.infoDotFillColor).toString());this.exhibitBorderColorInput.val(this.getHexColorFromColor(this.collectionTheme.infoDotBorderColor));n.Service.getCollection().done(function(n){var i=JSON.parse(n.theme);i==null?$(t.kioskmodeInput).prop("checked",!1):$(t.kioskmodeInput).prop("checked",i.kioskMode);$(t.chkEditors).prop("checked",n.MembersAllowed);t.renderManageEditorsButton()});this.chkEditors.off().click(function(){t.renderManageEditorsButton()})},i.prototype.colorIsRgba=function(n){return n?n.substr(0,5)==="rgba(":!1},i.prototype.colorIsRgb=function(n){return n?n.substr(0,4)==="rgb(":!1},i.prototype.colorIsHex=function(n){return n?n.substr(0,1)==="#"&&n.length>=7:!1},i.prototype.rgbaFromColor=function(n,t){var i;if(!n)return n;if(this.colorIsRgba(n))return i=n.substr(5,n.length-6).split(","),i.length>3?i[i.length-1]=t.toString():i.push(t.toString()),"rgba("+i.join(",")+")";var r=parseInt("0x"+n.substr(1,2)),u=parseInt("0x"+n.substr(3,2)),f=parseInt("0x"+n.substr(5,2));return"rgba("+r+","+u+","+f+","+t+")"},i.prototype.getOpacityFromRGBA=function(n){if(!n)return null;if(!this.colorIsRgba(n))return 1;var t=n.split(","),i=t[t.length-1].split(")")[0];return parseFloat(i)},i.prototype.getHexColorFromColor=function(n){if(this.colorIsHex(n))return n;if(!this.colorIsRgb(n)&&!this.colorIsRgba(n))return null;var i=this.colorIsRgb(n)?4:5,t=n.substr(i,n.length-i-1).split(","),r=t[t.length-1].split(")")[0];return"#"+this.colorHexFromInt(t[0])+this.colorHexFromInt(t[1])+this.colorHexFromInt(t[2])},i.prototype.colorHexFromInt=function(n){var t=Number(n).toString(16);return t.length===1?"0"+t:t},i.prototype.renderManageEditorsButton=function(){this.chkEditors.prop("checked")?this.btnEditors.slideDown("fast"):this.btnEditors.slideUp("fast")},i.prototype.updateCollectionTheme=function(n){this.collectionTheme={backgroundUrl:this.backgroundInput.val(),backgroundColor:"#232323",timelineColor:this.rgbaFromColor(this.timelineBackgroundColorInput.val(),this.timelineBackgroundOpacityInput.val()),timelineStrokeStyle:this.timelineBorderColorInput.val(),infoDotFillColor:this.rgbaFromColor(this.exhibitBackgroundColorInput.val(),this.exhibitBackgroundOpacityInput.val()),infoDotBorderColor:this.exhibitBorderColorInput.val(),kioskMode:this.kioskmodeInput.prop("checked")};this.colorIsRgb(this.timelineBackgroundColorInput.val())&&(this.timelineBackgroundColorInput.val(this.collectionTheme.timelineColor),this.exhibitBackgroundColorInput.val(this.collectionTheme.infoDotFillColor));n&&this.backgroundInput.hideError();this.updateCollectionThemeFromTheme(this.collectionTheme)},i.prototype.updateCollectionThemeFromTheme=function(t){n.Settings.applyTheme(t,!1);n.Common.vc.virtualCanvas("forEachElement",function(n){n.type==="timeline"?(n.settings.fillStyle=t.timelineColor,n.settings.strokeStyle=t.timelineStrokeStyle,n.settings.gradientFillStyle=t.timelineStrokeStyle):n.type==="infodot"&&(n.settings.fillStyle=t.infoDotFillColor,n.settings.strokeStyle=t.infoDotBorderColor)});n.Common.vc.virtualCanvas("requestInvalidate")},i.prototype.updateMediaInfo=function(){var n=!0;this.contentItem.mediaType=="skydrive-image"?(this.backgroundInput.val(this.contentItem.tempSource||""),n=!1,this.backgroundInput.showError("SkyDrive static links are not permanent. Consider hosting it as a public image instead.")):this.backgroundInput.val(this.contentItem.uri||"");this.updateCollectionTheme(n)},i.prototype.show=function(){t.prototype.show.call(this,{effect:"slide",direction:"left",duration:500});this.activationSource.addClass("active")},i.prototype.close=function(){var n=this;t.prototype.close.call(this,{effect:"slide",direction:"left",duration:500,complete:function(){n.backgroundInput.hideError();n.mediaList.remove()}});this.backgroundInput.hideError();this.updateCollectionThemeFromTheme(this.activeCollectionTheme)},i}(n.UI.FormUpdateEntity);t.FormEditCollection=i})(n.UI||(n.UI={}));var t=n.UI})(CZ||(CZ={}));
/*
//# sourceMappingURL=auth-edit-collection-form.min.js.map
*/