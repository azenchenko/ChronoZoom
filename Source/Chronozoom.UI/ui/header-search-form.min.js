var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},CZ;(function(n){(function(t){var i=function(t){function i(n,i){t.call(this,n,i);this.searchTextbox=n.find(i.searchTextbox);this.searchResultsBox=n.find(i.searchResultsBox);this.progressBar=n.find(i.progressBar);this.resultSections=n.find(i.resultSections);this.resultsCountTextblock=n.find(i.resultsCountTextblock);this.initialize()}return __extends(i,t),i.prototype.initialize=function(){var t=this,i,r;this.fillFormWithSearchResults();this.searchResults=[];this.progressBar.css("opacity",0);this.hideResultsCount();this.clearResultSections();this.hideSearchResults();this.searchTextbox.off();i=function(){clearTimeout(t.delayedSearchRequest);t.delayedSearchRequest=setTimeout(function(){var n=t.searchTextbox.val();n=t.escapeSearchQuery(n);t.showProgressBar();t.sendSearchQuery(n).then(function(n){t.hideProgressBar();t.searchResults=n?n.d:n;t.updateSearchResults()},function(n){console.log("Error connecting to service: search.\n"+n.responseText)})},300)};this.searchTextbox.on("input search",i);if(r=n.Settings.ie===9,r){this.searchTextbox.on("keyup",function(n){switch(n.which){case 8:case 46:i(n)}});this.searchTextbox.on("cut",i)}},i.prototype.sendSearchQuery=function(t){return t===""?$.Deferred().resolve(null).promise():n.Service.getSearch(t)},i.prototype.updateSearchResults=function(){var t=this;if(this.clearResultSections(),this.searchResults===null){this.hideSearchResults();return}if(this.searchResults.length===0){this.showNoResults();return}var i={0:"exhibit",1:"timeline",2:"contentItem"},r={exhibit:$(this.resultSections[1]),timeline:$(this.resultSections[0]),contentItem:$(this.resultSections[2])},u={exhibit:"e",timeline:"t",contentItem:""};this.searchResults.forEach(function(f){var o=t,e=i[f.objectType],s=u[e]+f.id,h=f.title;r[e].append($("<div><\/div>",{"class":"cz-form-search-result",text:h,"result-id":s,"result-type":e,click:function(){var t=$(this);n.Search.goToSearchResult(t.attr("result-id"),t.attr("result-type"));o.close()}}))});this.showResultsCount();this.showNonEmptySections()},i.prototype.fillFormWithSearchResults=function(){this.container.show();this.searchResultsBox.css("height","calc(100% - 150px)");this.searchResultsBox.css("height","-moz-calc(100% - 150px)");this.searchResultsBox.css("height","-webkit-calc(100% - 150px)");this.searchResultsBox.css("height","-o-calc(100% - 150px)");this.container.hide()},i.prototype.clearResultSections=function(){this.resultSections.find("div").remove()},i.prototype.escapeSearchQuery=function(n){return n?n.replace(/"/g,""):""},i.prototype.getResultsCountString=function(){var n=this.searchResults.length;return n+(n===1?" result":" results")},i.prototype.showProgressBar=function(){this.progressBar.animate({opacity:1})},i.prototype.hideProgressBar=function(){this.progressBar.animate({opacity:0})},i.prototype.showNonEmptySections=function(){this.searchResultsBox.show();this.resultSections.show();this.resultSections.each(function(n,t){var i=$(t).find("div");i.length===0&&$(t).hide()})},i.prototype.showNoResults=function(){this.searchResultsBox.show();this.resultSections.hide();this.resultsCountTextblock.show();this.resultsCountTextblock.text("No results")},i.prototype.showResultsCount=function(){this.searchResultsBox.show();this.resultsCountTextblock.show();this.resultsCountTextblock.text(this.getResultsCountString())},i.prototype.hideResultsCount=function(){this.resultsCountTextblock.hide()},i.prototype.hideSearchResults=function(){this.hideResultsCount();this.searchResultsBox.hide()},i.prototype.show=function(){var n=this;t.prototype.show.call(this,{effect:"slide",direction:"left",duration:500,complete:function(){n.searchTextbox.focus()}});this.activationSource.addClass("active")},i.prototype.close=function(){t.prototype.close.call(this,{effect:"slide",direction:"left",duration:500});this.activationSource.removeClass("active")},i}(n.UI.FormBase);t.FormHeaderSearch=i})(n.UI||(n.UI={}));var t=n.UI})(CZ||(CZ={}));
/*
//# sourceMappingURL=header-search-form.min.js.map
*/